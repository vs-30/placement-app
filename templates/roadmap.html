{% extends "layout.html" %}
{% block content %}
<style>
  .week-section {
    margin-bottom: 40px;
  }
  .week-header {
    font-size: 22px;
    font-weight: bold;
    color: #5a3eeb;
    margin-bottom: 15px;
  }
  .question-card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 15px;
  }
  .timer {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 10px;
  }
  .btn {
    margin-right: 8px;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    border: none;
  }
  .btn-start { background: #4CAF50; color: white; }
  .btn-pause { background: #ff9800; color: white; }
  .btn-stop { background: #f44336; color: white; }
  .btn-submit { background: #6c5ce7; color: white; margin-top: 10px; }
</style>

<div class="container mt-5">
  <h2 class="text-center mb-4">ðŸ“… Your Personalized Roadmap</h2>

  {% for week, questions in roadmap.items() %}
    <div class="week-section">
      <div class="week-header">Week {{ week }}</div>

      {% for q in questions %}
        <div class="question-card">
          <h5>{{ q['title'] }}</h5>
          <p><strong>Topic:</strong> {{ q['topic'] }} | <strong>Difficulty:</strong> {{ q['difficulty'] }}</p>
          <p><strong>Expected Time:</strong> {{ q['expected_time_min'] }} min</p>

          <div class="timer" id="timer-{{ week }}-{{ loop.index }}">00:00</div>

          <button class="btn btn-start" onclick="startTimer('{{ week }}-{{ loop.index }}')">Start</button>
          <button class="btn btn-pause" onclick="pauseTimer('{{ week }}-{{ loop.index }}')">Pause / Resume</button>
          <button class="btn btn-stop" onclick="stopTimer('{{ week }}-{{ loop.index }}')">Stop</button>

          <form action="{{ url_for('submit_time') }}" method="POST" style="display:none;" id="form-{{ week }}-{{ loop.index }}">
            <input type="hidden" name="week" value="{{ week }}">
            <input type="hidden" name="topic" value="{{ q['topic'] }}">
            <input type="hidden" name="question" value="{{ q['title'] }}">
            <input type="hidden" name="difficulty" value="{{ q['difficulty'] }}">
            <input type="hidden" name="expected_time" value="{{ q['expected_time_min'] }}">
            <input type="hidden" name="actual_time" id="actual-{{ week }}-{{ loop.index }}">
            <button type="submit" class="btn btn-submit">Submit</button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% endfor %}
</div>

<script>
let timers = {};

function startTimer(id) {
  if (!timers[id]) {
    timers[id] = {seconds: 0, running: false, interval: null};
  }
  if (!timers[id].running) {
    timers[id].running = true;
    timers[id].interval = setInterval(() => {
      timers[id].seconds++;
      document.getElementById("timer-" + id).innerText = formatTime(timers[id].seconds);
    }, 1000);
  }
}

function pauseTimer(id) {
  if (timers[id] && timers[id].running) {
    clearInterval(timers[id].interval);
    timers[id].running = false;
  } else if (timers[id] && !timers[id].running) {
    startTimer(id);
  }
}

function stopTimer(id) {
  if (timers[id]) {
    clearInterval(timers[id].interval);
    timers[id].running = false;
    document.getElementById("actual-" + id).value = timers[id].seconds;
    document.getElementById("form-" + id).style.display = "block";
  }
}

function formatTime(seconds) {
  let m = Math.floor(seconds / 60);
  let s = seconds % 60;
  return String(m).padStart(2, '0') + ":" + String(s).padStart(2, '0');
}
</script>
{% endblock %}
